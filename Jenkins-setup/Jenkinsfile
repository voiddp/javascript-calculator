pipeline {
	environment {
		registry = 'voiddp/nginx-calc'
		registryCredential = 'dockerhub'
		dockerImage = ''
	}
  agent any
  stages {
    stage('Cloning Git') {
      steps {
        git 'https://github.com/voiddp/javascript-calculator.git'
      }
    }
    stage('Processing Files') {
      steps {
          sh 'chmod +x ./Jenkins-setup/build.sh'
		  sh './Jenkins-setup/build.sh'
      }
    }
	stage('Bulding Image') {
      steps {
	   sh 'docker build -t "$registry:$BUILD_NUMBER" -f ./Jenkins-setup/Dockerfile .'
      }
    }	
	stage('Push to Hub') {
      steps {
		script {			
			docker.withRegistry( '', registryCredential ) {
				docker.image('$registry:$BUILD_NUMBER').push()
			}
		}
		sh "docker rmi $registry:$BUILD_NUMBER"
      }
    }	
  }
}
